<!doctype html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Havu√ß Topla - Web Oyunu</title>
    <meta
      name="description"
      content="Python pygame ile yapƒ±lmƒ±≈ü platform oyunu - Web tarayƒ±cƒ±sƒ±nda oyna!"
    />
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        padding: 20px;
        font-family: "Arial", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .container {
        max-width: 1200px;
        width: 100%;
        text-align: center;
      }
      h1 {
        font-size: 2.5em;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        background: linear-gradient(45deg, #ffd700, #ffa500);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .game-info {
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }
      .controls {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 15px;
        margin: 20px 0;
      }
      button {
        background: linear-gradient(45deg, #4caf50, #45a049);
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 16px;
        font-weight: bold;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }
      button:disabled {
        background: #cccccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }
      #gameCanvas {
        border: 3px solid white;
        border-radius: 15px;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        background: white;
        max-width: 100%;
      }
      .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 400px;
        font-size: 18px;
        flex-direction: column;
      }
      .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top: 4px solid white;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .status {
        margin: 15px 0;
        font-weight: bold;
        font-size: 18px;
        padding: 10px;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.1);
      }
      .error {
        color: #ff6b6b;
        background: rgba(255, 0, 0, 0.2);
        padding: 15px;
        border-radius: 10px;
        margin: 10px 0;
        border: 2px solid #ff6b6b;
      }
      .success {
        color: #4caf50;
        background: rgba(76, 175, 80, 0.2);
        border: 2px solid #4caf50;
      }
      .instructions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      .instruction-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 10px;
        text-align: left;
      }
      .instruction-item h4 {
        margin: 0 0 10px 0;
        color: #ffd700;
      }
      .debug-info {
        background: rgba(0, 0, 0, 0.3);
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        font-family: monospace;
        font-size: 12px;
        max-height: 200px;
        overflow-y: auto;
        text-align: left;
      }
      @media (max-width: 768px) {
        .container {
          padding: 10px;
        }
        h1 {
          font-size: 2em;
        }
        .instructions {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ü•ï Havu√ß Topla Oyunu</h1>

      <div class="game-info">
        <div class="instructions">
          <div class="instruction-item">
            <h4>üèÉ‚Äç‚ôÇÔ∏è Hareket</h4>
            <p>Ok tu≈ülarƒ± veya A/D ile saƒüa-sola hareket et</p>
          </div>
          <div class="instruction-item">
            <h4>‚¨ÜÔ∏è Zƒ±plama</h4>
            <p>Space, W veya yukarƒ± ok ile zƒ±pla</p>
          </div>
          <div class="instruction-item">
            <h4>üöÄ √ñzel Zƒ±plama</h4>
            <p>Z tu≈üu ile √∂zel zƒ±plama (3 havu√ß = y√ºksek, 6 havu√ß = s√ºper)</p>
          </div>
          <div class="instruction-item">
            <h4>üéØ Hedef</h4>
            <p>Havu√ßlarƒ± topla ve m√ºmk√ºn olduƒüunca y√ºkseƒüe √ßƒ±k!</p>
          </div>
        </div>
        <p>
          <strong>‚ö†Ô∏è Dikkat:</strong> Platformlar zaman i√ßinde kƒ±rƒ±lƒ±r, hƒ±zlƒ±
          ol!
        </p>
      </div>

      <div class="controls">
        <button id="loadGame">Python Runtime Y√ºkle</button>
        <button id="startGame" disabled>Oyunu Ba≈ülat</button>
        <button id="stopGame" disabled>Oyunu Durdur</button>
        <button id="debugBtn">Debug Bilgilerini G√∂ster</button>
      </div>

      <div id="status" class="status">Python runtime hen√ºz y√ºklenmedi</div>
      <div id="error" class="error" style="display: none"></div>
      <div id="debugInfo" class="debug-info" style="display: none"></div>

      <div id="gameContainer">
        <div id="loading" class="loading">
          <div class="spinner"></div>
          <div>Python runtime y√ºkleniyor...</div>
          <div style="font-size: 14px; margin-top: 10px">
            Bu i≈ülem 10-30 saniye s√ºrebilir...
          </div>
        </div>
        <canvas
          id="gameCanvas"
          width="400"
          height="700"
          style="display: none"
        ></canvas>
      </div>
    </div>

    <script>
            let pyodide = null;
            let gameRunning = false;
            let gameLoopId = null;
            let debugMode = false;

            const loadBtn = document.getElementById('loadGame');
            const startBtn = document.getElementById('startGame');
            const stopBtn = document.getElementById('stopGame');
            const debugBtn = document.getElementById('debugBtn');
            const statusDiv = document.getElementById('status');
            const errorDiv = document.getElementById('error');
            const debugDiv = document.getElementById('debugInfo');
            const loadingDiv = document.getElementById('loading');
            const canvas = document.getElementById('gameCanvas');

            function debugLog(message) {
              console.log(message);
              if (debugMode) {
                const timestamp = new Date().toLocaleTimeString();
                debugDiv.innerHTML += `[${timestamp}] ${message}<br>`;
                debugDiv.scrollTop = debugDiv.scrollHeight;
              }
            }

            debugBtn.addEventListener('click', () => {
              debugMode = !debugMode;
              debugDiv.style.display = debugMode ? 'block' : 'none';
              debugBtn.textContent = debugMode ? 'Debug Gizle' : 'Debug G√∂ster';
              if (debugMode) {
                debugLog('Debug modu aktif');
              }
            });

            // Python runtime y√ºkleme
            async function loadPyodide() {
              try {
                loadBtn.disabled = true;
                statusDiv.textContent = 'Python runtime y√ºkleniyor...';
                statusDiv.className = 'status';
                debugLog('Pyodide y√ºkleme ba≈üladƒ±');

                // √ñnce internet baƒülantƒ±sƒ±nƒ± test et
                try {
                  const testResponse = await fetch('https://cdn.jsdelivr.net/pyodide/v0.26.4/full/pyodide.js', { method: 'HEAD' });
                  if (!testResponse.ok) {
                    throw new Error('CDN eri≈üimi ba≈üarƒ±sƒ±z');
                  }
                  debugLog('CDN eri≈üimi ba≈üarƒ±lƒ±');
                } catch (e) {
                  debugLog('CDN test hatasƒ±: ' + e.message);
                  throw new Error('ƒ∞nternet baƒülantƒ±sƒ± veya CDN eri≈üim sorunu: ' + e.message);
                }

                // Pyodide script'ini y√ºkle (daha yeni versiyon)
                if (!window.loadPyodide) {
                  statusDiv.textContent = 'Pyodide k√ºt√ºphanesi indiriliyor...';
                  const script = document.createElement('script');
                  script.src = 'https://cdn.jsdelivr.net/pyodide/v0.26.4/full/pyodide.js';
                  script.crossOrigin = 'anonymous';

                  await new Promise((resolve, reject) => {
                    script.onload = () => {
                      debugLog('Pyodide script y√ºklendi');
                      resolve();
                    };
                    script.onerror = (e) => {
                      debugLog('Script y√ºkleme hatasƒ±: ' + e.message);
                      reject(new Error('Pyodide script y√ºklenemedi'));
                    };
                    document.head.appendChild(script);
                  });
                }

                // Pyodide ba≈ülat
                statusDiv.textContent = 'Python ortamƒ± ba≈ülatƒ±lƒ±yor...';
                debugLog('Pyodide ba≈ülatƒ±lƒ±yor');

                pyodide = await loadPyodide({
                  indexURL: 'https://cdn.jsdelivr.net/pyodide/v0.26.4/full/',
                  stdout: (text) => {
                    debugLog('Python stdout: ' + text);
                  },
                  stderr: (text) => {
                    debugLog('Python stderr: ' + text);
                    console.error('Python stderr:', text);
                  }
                });

                debugLog('Pyodide ba≈üarƒ±yla y√ºklendi');

                // Pygame y√ºkle
                statusDiv.textContent = 'Pygame k√ºt√ºphanesi y√ºkleniyor...';
                debugLog('Pygame y√ºkleniyor');

                try {
                  await pyodide.loadPackage(['pygame']);
                  debugLog('Pygame ba≈üarƒ±yla y√ºklendi');
                } catch (e) {
                  debugLog('Pygame y√ºkleme hatasƒ±: ' + e.message);
                  // Pygame y√ºklenemezse basit mock ile devam et
                  console.warn('Pygame y√ºklenemedi, mock kullanƒ±lacak');
                }

                statusDiv.textContent = 'Hazƒ±r! Oyunu ba≈ülatabilirsiniz.';
                statusDiv.className = 'status success';
                startBtn.disabled = false;
                loadingDiv.style.display = 'none';
                canvas.style.display = 'block';
                debugLog('Sistem hazƒ±r');

              } catch (error) {
                debugLog('Genel hata: ' + error.message);
                console.error('Python y√ºkleme hatasƒ±:', error);
                showError('Python runtime y√ºklenemedi: ' + error.message + '\\n\\nL√ºtfen:\\n1. ƒ∞nternet baƒülantƒ±nƒ±zƒ± kontrol edin\\n2. Tarayƒ±cƒ±nƒ±zƒ± yenileyin\\n3. Farklƒ± bir tarayƒ±cƒ± deneyin');
                statusDiv.textContent = 'Y√ºkleme ba≈üarƒ±sƒ±z';
                loadBtn.disabled = false;
              }
            }

            // Oyunu ba≈ülat
            async function startGame() {
              if (!pyodide || gameRunning) return;

              try {
                gameRunning = true;
                startBtn.disabled = true;
                stopBtn.disabled = false;
                statusDiv.textContent = 'Oyun ba≈ülatƒ±lƒ±yor...';
                debugLog('Oyun ba≈ülatƒ±lƒ±yor');

                // Canvas context'i al
                const ctx = canvas.getContext('2d');

                // Python pygame kodunu √ßalƒ±≈ütƒ±r
                await pyodide.runPython(\`
      import sys
      import random
      try:
          import pygame
          pygame_available = True
      except ImportError:
          pygame_available = False
          print("Pygame bulunamadƒ±, mock kullanƒ±lacak")

      # JavaScript mod√ºllerine eri≈üim
      import js

      # Canvas'a eri≈üim
      canvas = js.document.getElementById('gameCanvas')
      ctx = canvas.getContext('2d')

      print("Oyun ba≈ülatƒ±lƒ±yor...")

      # Oyun ayarlarƒ±
      GENISLIK = 400
      YUKSEKLIK = 700
      FPS = 60

      # Platform ayarlarƒ±
      PLATFORM_YUKSEKLIK = 20
      PLATFORM_GENISLIK_UZUN = 120
      PLATFORM_GENISLIK_KISA = 60

      # Oyuncu ayarlarƒ±
      OYUNCU_HIZ = 5
      YERCEKIMI = 0.5
      ZIPLAMA_GUCU = -10
      YUKSEK_ZIP_GUCU = -18
      SUPER_ZIP_GUCU = -24

      # Item ayarlarƒ±
      HAVUC_GENISLIK = 30
      HAVUC_YUKSEKLIK = 30

      # Platform kƒ±rƒ±lma ayarlarƒ±
      KIRILMA_SURESI = 2500
      KIRILMA_HIZLANMA = 20
      MIN_KIRILMA_SURESI = 800

      # Renkler
      GOK_MAVISI = (135, 206, 235)
      BEYAZ = (255, 255, 255)
      HAVUC_RENGI = (255, 165, 0)
      YESIL = (34, 139, 34)
      KIRMIZI = (220, 20, 60)
      MAVI = (30, 144, 255)
      ACIK_YESIL = (144, 238, 144)

      # Mock pygame eƒüer gerekirse
      if not pygame_available:
          class MockPygame:
              def init(self): pass
              def quit(self): pass
          pygame = MockPygame()
          print("Mock pygame kullanƒ±lƒ±yor")

      # Pygame ba≈ülat
      if pygame_available:
          pygame.init()
          print("Pygame ba≈ülatƒ±ldƒ±")

      # Web klavye durumu
      keys_pressed = set()
      keys_just_pressed = set()

      def setup_keyboard():
          def keydown(event):
              if event.code not in keys_pressed:
                  keys_just_pressed.add(event.code)
              keys_pressed.add(event.code)
              event.preventDefault()

          def keyup(event):
              keys_pressed.discard(event.code)
              event.preventDefault()

          js.document.addEventListener('keydown', keydown)
          js.document.addEventListener('keyup', keyup)

      setup_keyboard()
      print("Klavye kontrolleri ayarlandƒ±")

      # Oyuncu sƒ±nƒ±fƒ±
      class Oyuncu:
          def __init__(self, x, y):
              self.x = x
              self.y = y
              self.width = 32
              self.height = 32
              self.hiz_y = 0
              self.yerde_mi = False
              self.combo = 0
              self.havuc_sayisi = 0

          def guncelle(self, platformlar, itemlar, zaman):
              global keys_just_pressed

              # Hareket kontrolleri
              if 'ArrowLeft' in keys_pressed or 'KeyA' in keys_pressed:
                  self.x -= OYUNCU_HIZ
              if 'ArrowRight' in keys_pressed or 'KeyD' in keys_pressed:
                  self.x += OYUNCU_HIZ

              # Sƒ±nƒ±r kontrol√º
              self.x = max(0, min(self.x, GENISLIK - self.width))

              # Yer√ßekimi
              self.hiz_y += YERCEKIMI
              self.y += self.hiz_y
              self.yerde_mi = False

              # Platform √ßarpƒ±≈ümasƒ±
              for platform in platformlar:
                  if (self.x < platform.x + platform.width and
                      self.x + self.width > platform.x and
                      self.y < platform.y + platform.height and
                      self.y + self.height > platform.y and
                      self.hiz_y > 0):
                      self.y = platform.y - self.height
                      self.hiz_y = 0
                      self.yerde_mi = True
                      platform.kirilmaya_basla(zaman)

              # Havu√ß toplama
              for item in list(itemlar):
                  if (self.x < item.x + item.width and
                      self.x + self.width > item.x and
                      self.y < item.y + item.height and
                      self.y + self.height > item.y):
                      itemlar.remove(item)
                      self.havuc_sayisi += 1

              # Zƒ±plama kontrolleri
              zipla_tuslarƒ± = {'Space', 'KeyW', 'ArrowUp'}
              if any(key in keys_just_pressed for key in zipla_tuslarƒ±) and self.yerde_mi:
                  self.zipla()

              # √ñzel zƒ±plama
              if 'KeyZ' in keys_just_pressed and self.yerde_mi:
                  if self.havuc_sayisi >= 6:
                      self.hiz_y = SUPER_ZIP_GUCU
                      self.havuc_sayisi -= 6
                      self.combo += 1
                  elif self.havuc_sayisi >= 3:
                      self.hiz_y = YUKSEK_ZIP_GUCU
                      self.havuc_sayisi -= 3
                      self.combo += 1

              # Tu≈ü durumunu temizle
              keys_just_pressed.clear()

          def zipla(self):
              self.hiz_y = ZIPLAMA_GUCU
              self.combo += 1

          def draw(self):
              # Oyuncu √ßizimi
              ctx.fillStyle = f'rgb({MAVI[0]},{MAVI[1]},{MAVI[2]})'
              ctx.fillRect(self.x, self.y, self.width, self.height)

              # G√∂zler
              ctx.fillStyle = 'white'
              ctx.fillRect(self.x + 6, self.y + 8, 6, 6)
              ctx.fillRect(self.x + 20, self.y + 8, 6, 6)

              ctx.fillStyle = 'black'
              ctx.fillRect(self.x + 8, self.y + 10, 2, 2)
              ctx.fillRect(self.x + 22, self.y + 10, 2, 2)

      class Platform:
          def __init__(self, x, y, width, sabit=False):
              self.x = x
              self.y = y
              self.width = width
              self.height = PLATFORM_YUKSEKLIK
              self.sabit = sabit
              self.kiriliyor = False
              self.kirilma_baslangic = 0
              self.orijinal_width = width

          def kirilmaya_basla(self, zaman):
              if not self.sabit and not self.kiriliyor:
                  self.kiriliyor = True
                  self.kirilma_baslangic = zaman

          def guncelle(self, zaman, skor):
              if self.kiriliyor and not self.sabit:
                  sure = max(MIN_KIRILMA_SURESI, KIRILMA_SURESI - (skor // 1000) * KIRILMA_HIZLANMA)
                  gecen_sure = zaman - self.kirilma_baslangic
                  if gecen_sure > sure:
                      return False  # Platform kƒ±rƒ±ldƒ±
                  else:
                      # Platform k√º√ß√ºl√ºyor
                      kalan_oran = 1 - (gecen_sure / sure)
                      self.width = max(20, int(self.orijinal_width * kalan_oran))
              return True

          def draw(self):
              if self.kiriliyor and not self.sabit:
                  # Kƒ±rƒ±lan platform - kƒ±rmƒ±zƒ±
                  ctx.fillStyle = f'rgb({KIRMIZI[0]},{KIRMIZI[1]},{KIRMIZI[2]})'
              elif self.sabit:
                  # Sabit platform - koyu ye≈üil
                  ctx.fillStyle = f'rgb({YESIL[0]},{YESIL[1]},{YESIL[2]})'
              else:
                  # Normal platform - a√ßƒ±k ye≈üil
                  ctx.fillStyle = f'rgb({ACIK_YESIL[0]},{ACIK_YESIL[1]},{ACIK_YESIL[2]})'

              ctx.fillRect(self.x, self.y, self.width, self.height)

              # Platform kenarlƒ±ƒüƒ±
              ctx.strokeStyle = f'rgb({YESIL[0]},{YESIL[1]},{YESIL[2]})'
              ctx.lineWidth = 2
              ctx.strokeRect(self.x, self.y, self.width, self.height)

      class Havuc:
          def __init__(self, x, y):
              self.x = x
              self.y = y
              self.width = HAVUC_GENISLIK
              self.height = HAVUC_YUKSEKLIK
              self.anim_offset = 0

          def update(self):
              self.anim_offset += 0.2

          def draw(self):
              # Animasyonlu havu√ß
              offset = int(3 * abs(js.Math.sin(self.anim_offset)))
              ctx.fillStyle = f'rgb({HAVUC_RENGI[0]},{HAVUC_RENGI[1]},{HAVUC_RENGI[2]})'
              ctx.fillRect(self.x, self.y - offset, self.width, self.height)

              # Havu√ß yapraklarƒ±
              ctx.fillStyle = f'rgb({YESIL[0]},{YESIL[1]},{YESIL[2]})'
              ctx.fillRect(self.x + 8, self.y - offset, 14, 8)

      # Oyun nesneleri
      oyuncu = Oyuncu(GENISLIK // 2, YUKSEKLIK - 100)
      platformlar = []
      itemlar = []

      # Ba≈ülangƒ±√ß platformu
      baslangic_platform = Platform(GENISLIK // 2 - PLATFORM_GENISLIK_UZUN // 2, YUKSEKLIK - 50, PLATFORM_GENISLIK_UZUN, True)
      platformlar.append(baslangic_platform)

      # Platform olu≈üturma
      def platform_olustur():
          min_y = YUKSEKLIK - 120
          for i in range(15):
              x = random.randint(0, GENISLIK - PLATFORM_GENISLIK_UZUN)
              y = min_y - (i * random.randint(80, 120))
              width = random.choice([PLATFORM_GENISLIK_KISA, PLATFORM_GENISLIK_UZUN])
              platform = Platform(x, y, width)
              platformlar.append(platform)

              # Havu√ß ekleme ≈üansƒ±
              if random.random() < 0.6:
                  havuc = Havuc(x + width // 2 - HAVUC_GENISLIK // 2, y - 35)
                  itemlar.append(havuc)

      platform_olustur()

      # Oyun deƒüi≈ükenleri
      skor = 0
      kayma = 0
      oyun_aktif = True
      zaman = js.Date.now()
      en_yuksek_skor = 0

      print("Havu√ß Topla oyunu ba≈üarƒ±yla ba≈ülatƒ±ldƒ±!")
      print(f"Toplam platform sayƒ±sƒ±: {len(platformlar)}")
      print(f"Toplam havu√ß sayƒ±sƒ±: {len(itemlar)}")
      \`);

                statusDiv.textContent = 'Oyun √ßalƒ±≈üƒ±yor! Klavye kontrolleri aktif.';
                debugLog('Python kodu ba≈üarƒ±yla √ßalƒ±≈ütƒ±rƒ±ldƒ±');

                // Oyun d√∂ng√ºs√ºn√º ba≈ülat
                gameLoop();

              } catch (error) {
                debugLog('Oyun ba≈ülatma hatasƒ±: ' + error.message);
                console.error('Oyun ba≈ülatma hatasƒ±:', error);
                showError('Oyun ba≈ülatƒ±lamadƒ±: ' + error.message);
                gameRunning = false;
                startBtn.disabled = false;
                stopBtn.disabled = true;
              }
            }

            // Oyun d√∂ng√ºs√º
            function gameLoop() {
              if (!gameRunning) return;

              try {
                // Python oyun mantƒ±ƒüƒ±nƒ± √ßalƒ±≈ütƒ±r
                pyodide.runPython(\`
      # Zaman g√ºncelleme
      yeni_zaman = js.Date.now()
      dt = yeni_zaman - zaman
      zaman = yeni_zaman

      if oyun_aktif:
          # Oyuncu g√ºncelleme
          oyuncu.guncelle(platformlar, itemlar, zaman)

          # Platform g√ºncelleme
          platformlar[:] = [p for p in platformlar if p.guncelle(zaman, skor)]

          # Item g√ºncelleme
          for item in itemlar:
              item.update()

          # Kamera kaydƒ±rma
          if oyuncu.y <= YUKSEKLIK // 3:
              kayma = YUKSEKLIK // 3 - oyuncu.y
              oyuncu.y = YUKSEKLIK // 3
              skor += int(kayma // 5)

              # T√ºm nesneleri a≈üaƒüƒ± kaydƒ±r
              for platform in platformlar:
                  platform.y += kayma
              for item in itemlar:
                  item.y += kayma

              # Ekran dƒ±≈üƒ±na √ßƒ±kan nesneleri temizle
              platformlar[:] = [p for p in platformlar if p.y < YUKSEKLIK + 100]
              itemlar[:] = [i for i in itemlar if i.y < YUKSEKLIK + 100]

              # Yeni platformlar ekle
              if len(platformlar) < 12:
                  for _ in range(3):
                      x = random.randint(0, GENISLIK - PLATFORM_GENISLIK_UZUN)
                      y = min([p.y for p in platformlar]) - random.randint(80, 120)
                      width = random.choice([PLATFORM_GENISLIK_KISA, PLATFORM_GENISLIK_UZUN])
                      platform = Platform(x, y, width)
                      platformlar.append(platform)

                      if random.random() < 0.6:
                          havuc = Havuc(x + width // 2 - HAVUC_GENISLIK // 2, y - 35)
                          itemlar.append(havuc)

          # Oyun biti≈üi kontrol√º
          if oyuncu.y > YUKSEKLIK:
              oyun_aktif = False
              if skor > en_yuksek_skor:
                  en_yuksek_skor = skor

      # √áizim - G√∂ky√ºz√º gradient
      gradient = ctx.createLinearGradient(0, 0, 0, YUKSEKLIK)
      gradient.addColorStop(0, f'rgb({GOK_MAVISI[0]},{GOK_MAVISI[1]},{GOK_MAVISI[2]})')
      gradient.addColorStop(1, 'rgb(200,230,255)')
      ctx.fillStyle = gradient
      ctx.fillRect(0, 0, GENISLIK, YUKSEKLIK)

      # Bulutlar i√ßin basit efekt
      for i in range(5):
          x = (i * 100 + int(zaman * 0.01) % 500) % (GENISLIK + 50)
          y = 50 + i * 80
          ctx.fillStyle = 'rgba(255,255,255,0.3)'
          ctx.beginPath()
          ctx.arc(x, y, 20, 0, 2 * js.Math.PI)
          ctx.arc(x + 20, y, 25, 0, 2 * js.Math.PI)
          ctx.arc(x + 40, y, 20, 0, 2 * js.Math.PI)
          ctx.fill()

      # Nesneleri √ßiz
      for platform in platformlar:
          if -100 < platform.y < YUKSEKLIK + 100:
              platform.draw()

      for item in itemlar:
          if -100 < item.y < YUKSEKLIK + 100:
              item.draw()

      oyuncu.draw()

      # HUD - Geli≈ümi≈ü
      ctx.fillStyle = 'rgba(0,0,0,0.5)'
      ctx.fillRect(0, 0, GENISLIK, 120)

      ctx.fillStyle = f'rgb({BEYAZ[0]},{BEYAZ[1]},{BEYAZ[2]})'
      ctx.font = 'bold 20px Arial'
      ctx.fillText(f'SKOR: {skor}', 20, 30)
      ctx.font = '16px Arial'
      ctx.fillText(f'COMBO: x{oyuncu.combo}', 20, 55)
      ctx.fillText(f'HAVUC: {oyuncu.havuc_sayisi}', 20, 75)
      ctx.fillText(f'EN YUKSEK: {en_yuksek_skor}', 20, 95)

      if not oyun_aktif:
          # Oyun bitti ekranƒ±
          ctx.fillStyle = 'rgba(0,0,0,0.8)'
          ctx.fillRect(0, 0, GENISLIK, YUKSEKLIK)

          ctx.fillStyle = f'rgb({BEYAZ[0]},{BEYAZ[1]},{BEYAZ[2]})'
          ctx.font = 'bold 32px Arial'
          ctx.textAlign = 'center'
          ctx.fillText('OYUN BITTI', GENISLIK//2, YUKSEKLIK//2 - 60)
          ctx.font = 'bold 24px Arial'
          ctx.fillText(f'Son Skor: {skor}', GENISLIK//2, YUKSEKLIK//2 - 20)
          if skor == en_yuksek_skor and skor > 0:
              ctx.fillStyle = 'gold'
              ctx.fillText('YENI REKOR!', GENISLIK//2, YUKSEKLIK//2 + 20)
          ctx.fillStyle = f'rgb({BEYAZ[0]},{BEYAZ[1]},{BEYAZ[2]})'
          ctx.font = '18px Arial'
          ctx.fillText('Yeniden ba≈ülatmak i√ßin', GENISLIK//2, YUKSEKLIK//2 + 60)
          ctx.fillText('"Oyunu Ba≈ülat" butonuna tƒ±klayƒ±n', GENISLIK//2, YUKSEKLIK//2 + 85)
          ctx.textAlign = 'left'
      \`);

                // Oyun devam ediyorsa d√∂ng√ºy√º s√ºrd√ºr
                if (gameRunning) {
                  gameLoopId = requestAnimationFrame(gameLoop);
                }

              } catch (error) {
                debugLog('Oyun d√∂ng√ºs√º hatasƒ±: ' + error.message);
                console.error('Oyun d√∂ng√ºs√º hatasƒ±:', error);
                showError('Oyun hatasƒ±: ' + error.message);
                stopGame();
              }
            }

            // Oyunu durdur
            function stopGame() {
              gameRunning = false;
              if (gameLoopId) {
                cancelAnimationFrame(gameLoopId);
                gameLoopId = null;
              }
              startBtn.disabled = false;
              stopBtn.disabled = true;
              statusDiv.textContent = 'Oyun durduruldu';
              statusDiv.className = 'status';
              debugLog('Oyun durduruldu');
            }

            // Hata g√∂ster
            function showError(message) {
              errorDiv.textContent = message;
              errorDiv.style.display = 'block';
              setTimeout(() => {
                errorDiv.style.display = 'none';
              }, 10000);
            }

            // Event listener'lar
            loadBtn.addEventListener('click', loadPyodide);
            startBtn.addEventListener('click', startGame);
            stopBtn.addEventListener('click', stopGame);

            // Canvas focus i√ßin
            canvas.addEventListener('click', () => {
              canvas.focus();
              canvas.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });
            canvas.tabIndex = 0;

            // Sayfa y√ºklendiƒüinde kontrol
            window.addEventListener('load', () => {
              debugLog('Sayfa y√ºklendi');
              console.log('Havu√ß Topla oyunu hazƒ±r - Python runtime y√ºklemek i√ßin butona tƒ±klayƒ±n');
            });

            // Hata yakalama
            window.addEventListener('error', (e) => {
              debugLog('JavaScript hatasƒ±: ' + e.message);
              console.error('JavaScript hatasƒ±:', e);
            });

            window.addEventListener('unhandledrejection', (e) => {
              debugLog('Promise hatasƒ±: ' + e.reason);
              console.error('Promise hatasƒ±:', e.reason);
            });
    </script>
  </body>
</html>
